generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("PRISMA_DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                    String                @id @default(cuid())
  email                 String                @unique
  passwordHash          String
  username              String                @unique
  displayName           String?
  bio                   String?
  avatarUrl             String?
  youtubeChannelId      String?
  tiktokUsername        String?
  instagramUsername     String?
  subscriptionStatus    String                @default("TRIAL")
  subscriptionExpiresAt DateTime?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  materials             Material[]
  subscription          Subscription?
  videoMaterials        VideoMaterial[]

  @@map("users")
}

model Material {
  id             String          @id @default(cuid())
  creatorId      String
  title          String
  description    String?
  fileUrl        String
  fileType       String
  secretCode     String
  downloadCount  Int             @default(0)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  accessRequests AccessRequest[]
  creator        User            @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  videoMaterials VideoMaterial[]

  @@map("materials")
}

model AccessRequest {
  id                String    @id @default(cuid())
  materialId        String
  followerEmail     String
  followerName      String?
  secretCodeAttempt String
  screenshotUrl     String
  status            String    @default("PENDING")
  rejectionReason   String?
  reviewedAt        DateTime?
  createdAt         DateTime  @default(now())
  material          Material  @relation(fields: [materialId], references: [id], onDelete: Cascade)

  @@map("access_requests")
}

model VideoMaterial {
  id             String   @id @default(cuid())
  creatorId      String
  materialId     String
  videoPlatform  String
  videoId        String
  videoTitle     String
  videoThumbnail String
  createdAt      DateTime @default(now())
  creator        User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  material       Material @relation(fields: [materialId], references: [id], onDelete: Cascade)

  @@map("video_materials")
}

model Subscription {
  id                   String    @id @default(cuid())
  userId               String    @unique
  stripeCustomerId     String?   @unique
  stripeSubscriptionId String?   @unique
  status               String    @default("ACTIVE")
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}
